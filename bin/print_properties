#!/usr/bin/env ruby

require_relative '../lib/easy_broker'

API_KEY  = ENV['EASYBROKER_API_KEY']
BASE_URL = ENV.fetch('EASYBROKER_BASE_URL', 'https://api.stagingeb.com')

begin
  raise 'Missing EASYBROKER_API_KEY environment variable' if API_KEY.to_s.strip.empty?

  puts 'Initializing EasyBroker Client...'
  client = EasyBroker::ApiClient.new(api_key: API_KEY, base_url: BASE_URL)

  puts 'Fetching all properties (this may take a moment)...'
  repository = EasyBroker::PropertyRepository.new(client)

  properties = repository.find_all

  puts "\nFound #{properties.count} properties:"
  puts '-' * 40

  properties.each do |property|
    puts property.title
  end

  puts '-' * 40
  puts 'Done.'
rescue StandardError => e
  warn "An error occurred: #{e.message}"
  exit 1
end
